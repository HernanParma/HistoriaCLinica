using HistoriaClinica.Models;
using HistoriaClinica.Helpers;
using Microsoft.EntityFrameworkCore;
using System.Globalization;
using System.Text.RegularExpressions;

namespace HistoriaClinica.Data
{
    public static class SeedData
    {
        public static async Task Initialize(IServiceProvider serviceProvider)
        {
            using var context = new AppDbContext(
                serviceProvider.GetRequiredService<DbContextOptions<AppDbContext>>());

            // Verificar si ya existen usuarios
            if (await context.Usuarios.AnyAsync())
            {
                return; // Ya hay datos, no hacer nada
            }

            // Crear usuario administrador por defecto
            var adminUser = new Usuario
            {
                NombreUsuario = "admin",
                ContrasenaHash = PasswordHelper.Hashear("admin123"),
                Email = "admin@admin.com",
                Perfil = "medico",
                Verificado = true
            };

            context.Usuarios.Add(adminUser);
            await context.SaveChangesAsync();

            Console.WriteLine("Usuario administrador creado:");
            Console.WriteLine("Usuario: admin");
            Console.WriteLine("Contraseña: admin123");
        }

        public static void Initialize(AppDbContext context)
        {
            // Permitir agregar datos a una base existente, pero sin duplicar por DNI
            var data = @"
Nro Afiliado	Nombre	DNI	Peso	TELEFONO	T.A.	F. Nac.	MAIL	ALTURA	QR	OBRA SOCIAL	Fecha1	Consulta1	Fecha2	Consulta2	Fecha3	Consulta3	Fecha4	Consulta4	Fecha5	Consulta5	Fecha6	Consulta6	Fecha7	Consulta7	Fecha8	Consulta8	Fecha9	Consulta9	Fecha10	Consulta10	Fecha11	Consulta11	Fecha12	Consulta12	Fecha13	Consulta13	Fecha14	Consulta14	Fecha15	Consulta15	Fecha16	Consulta16	Fecha17	Consulta17	Fecha18	Consulta18	Fecha19	Consulta19	Fecha20	Consulta20	Fecha21	Consulta21	Fecha22	Consulta22	Fecha23	Consulta23	Fecha24	Consulta24	Fecha25	Consulta25	Fecha26	Consulta26	Fecha27	Consulta27	Fecha28	Consulta28	Antecedentes1	Antecedentes2	Antecedentes3	Antecedentes4	Antecedentes5	Antecedentes6	Antecedentes7	Antecedentes8	Medicacion1	Medicacion2	Medicacion3	Medicacion4	Medicacion5	Medicacion6	Medicacion7	Medicacion8	Medicacion9	Medicacion10	Medicacion11	Medicacion12	Medicacion13	Medicacion14	
15041654940500	ACCARDI MARIA DEL CARMEN    	6037082							accardi.pdf			                                    		                                    	28/1/2025	eco mamaria: BIRADS-3 mama derecha en h1 quiste 5,8x2,8 con fino tabique interno, MAMA IZQ: ecoestructura heterogeneo H2 nodulo, ovalado, margenes definidos de 8,6x2,4                           		regiones retroglandulares normales                           		ECOtv: utero heterogeneo, mioma 6x3                           		ECOABD: s/p                           		mamo: BIRADS 3                           		                                    		                                    		                                    		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           																	                    	                    	                    	                    	                	                	                	                	                    	                    	     	                    	                    	                    	                   	                	                	                	                	                	            	            	
140107240700	ACOSTA CATALINA DEL CARMEN	12186168																																																																																							
140059893000	ACOSTA VICTOR GREGORIO	11833267																																																																																							
15037833730400	Acuña Beatriz Angelica								acuña.pdf																																																																																
465027441500	ACUÑA OSVALDO ESTEBAN	13855686							AcuñaOs.jpeg																																																																																
15053140480200	AGNESE SERGIO    	32866066		1167153769		6/3/1987			[Ljava.lang.Object;@40ce0a77	PAMI	12/2/2024	Concurre hermana para completar planilla de pami por medicacion por via de excepcion.                  	               	                                 	            	                              	            	                              	               	                                 	               	                                 	               	                                 	               	                              		         	     	                                         	    	                                        	    	                                        	     	                                         	     	                                         	     	                                         	     	                                        		                                             		                                             		                                             		                                             		         		         		         		         		         		         		         		         		         	ACV 2010, secundario a MAV               	Craniectomia descomprensiva               	Epilepsis secuelar          	                                         	    	                                        	    	                                        	     	                                         	     	                                         	     	                                         	     	                                        	    	    	    	    	    	    	
15040640210300	AGOSTA JUANA	93679263																																																																																							
145074997509	AGUILERA JULIETA DENISEE	47629189																																																																																							
150646767809	AGUIRRE ALDO ROQUE 	11890726							https://1drv.ms/b/c/7ba672b4594717b6/EbYXR1m0cqYggHvZJgAAAAABY00Td8yjQK2I-Qc53VYReQ?e=bbgZ1p		23	

		         		         		         		         		         		         		         		         		         																																					     	     	     	     	    	    	    	    	     	     	     	     	     	     	    	    	    	    	    	    			
150372941506	AGUIRRE ROSA ANGELICA	5317319																																																																																							
14010488280100	AIELLO DANIEL ANIBAL   	13134145		1155989820		3/6/1957	daiello3@hotmail.com			PAMI	19/4/2022	tg 141 col 160 tgo 23 tgp 40 cr 0,43 gr 4,91 hto 43 hb 14,90 gb 5,43 hba1c 6,18 urea 41                            		ecodoppler: VI con relajacion prolongada                           		                           	14/6/2024	herpes zooster.                            		urocultivo no se abs. desarrollo bact. no infeccion urinaria, gr 4,57 hto 40 hb 13,70 gb 5270 gluc 139 hba1c 6,24 urico 4,50 cr 0,74 got 23 gpt 32 ct 131 tg 71 tsh 2,16 psa 0,6 vitD 17 plaq 140000                           		                           	6/1/2025	orina lig turbia. gr 4,6 hto 40 hb 14 gb 180 plaq 163000 gluc 111 hba1c 5,97 urico 5,70 cr 0,78 got 20 gpt 29 ct 133 tg 70                  		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           		                           																	DBT II               	HTA               	               	               	            	            	            	            	met 1 g x 60 comp (dbi forte)               	sitagliptina(januvia) 100 mg x 28 comp               	losacor d 100 (losartan + hidrocloro) x 30 comp               	atorvastatina 20 mg x 30 comp (lipiden)               	etoricoxib 90 mg x 30 comp               	ass prevent               	omeprazol 20 mg x 30 comp               	            	            	            	pregabalina 75 x 30 comp            	tramadol 50 mg 30 comp            	gabapentin 600 x 30 comp            	vit b1,b6, b12 nervomax tb            	
14595191600700	AIELLO DARIO GUSTAVO    	14825105	90 kg	1155989820		30/12/1961	daiello3@hotmail.com	180 cm		PAMI	1/4/2021	t4 1,04 tsh 2,28 tgo 15 tgp 14 hba1c 6,11 ct 199 urea 47 gr 4,42 hto 39 gb 5470 hb 12,7 gluc 121 plaq 158000         		                                    		                                    		                                    		                                    	6/1/2024	CUD: problemas relacionados con la limitacion de las actividades debido a discapacidad. retraso mental. tetrologia de fallot.                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    	EX TABAQUISTA                    	EPOC               	ARTROSIS DE RODILLA                	                    	                	                	                	                	neumoterol 200 (budesonide200+formaterol 6 mcg) x 20 cap                    	glucosamina sulfato 1500 gr x 30 sobres                    	                    	                    	                    	                    	                    	                	                	                	                	                	                	
140115984906	ALARD DANIEL MARIO    	13262576	84 kg	1160009395		25/8/1957	danielalard13@hotmail.com	1,72		PAMI	9/22	hto 39 hb 13,1 gr 4,62 gb 17,2 uremia 52 gluc 102 plaq 277 11/23: ARTROSCOPIA rodilla derecha                                    		                                    	3/24	TC MACIZOFACIAL: velamiento seno maxilar, cornete y tabique nasal, rinosinusitis cronico. RX TORAX: elongacion aortica. ECG: BCRI, sinusal, extrasistoles. en seguimiento con cardiologia. Lo opero dr san juan htal argerich secuela paresia OD 1/24: orina oxalato calcio gr 4,83 hto 41 hb 13,7 gb 7900 hba1c 6,31 urea 38 cr 0,91 got 28 gpt 18 ct 183 tg 214 t4 0,11 tsh mayor 100 psa 2,89                                    		                                    	4/24	orina normal gr 4,40 hto 38 hb 12,1 gb 6290 plaq 274000 hba1c 5,83 cr 0,80 got 43 gpt 20 ct 172 tg 178 tsh mayor 100 RX TORAX: s/p elong AO                                    		                                    	29/3/2025	GR: 4,68 HTO: 43 HB: 13,7 GB:6650 PLAQ:244000 GLUC:89 UREA:39 CR: 0,98 GOT: 24 GPT: 37 CT: 193 TG: 265 FAL: 48 ORINA: s/p URICO: 7,10 1 comp/noche segren OMES: cardio, neumo y espirometria                  		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    	EX TABAQUISTA                    	EPOC               	ARTROSIS DE RODILLA                	                    	                	                	                	                	neumoterol 200 (budesonide200+formaterol 6 mcg) x 20 cap                    	glucosamina sulfato 1500 gr x 30 sobres                    	                    	                    	                    	                    	                    	                	                	                	                	                	                	
150260643306	ALBAMONTE ALFREDO JORGE      	4373728	95	1165413700		17/4/1941	cliolatilve@hotmail.com	170		PAMI	11/22	HTO 39 GR 4,68 HB 12,6 GB 6200 COL 216 TG 406 GLUC 316 UREMIA 95 CR 1,94 URICEMIA 6,7 TSH 2,04                                             		                                                      	5/23	HTO 40 GR 4,91 HB 12,9 GB 6300 GLUC 261 UREMIA 62 CR 1,93 COL 221 TG 199 HBA1C 9,5 PSA 0,59 GPT 7 GOT 12 ORINA GLUC +++                                             		                                                      	7/23	ECOG ING DERECHA: voluminoso foco hemiforo con contenido de asas intestinales peristalticas, tej adiposo, lig libre, 117x60,2mm. no se reduce ante compresion.                                              		                                                      	7/24	HTO 38 GR 4,69 HB 12,4 GB 5800 GLUCEMIA 180 UREMIA 50 CREATININA 1,63 URICEMIA 7,2 COL 234 TG 371 TSH 1,73 HBA1C 7,6 GPT 5 GOT 8 PSA 2,69 ORINA NORMAL                                             		                                                      	19/4/2025	Labo 1/25: GR:4,79 HTO:40 HB:12,4 GB:6100 PLAQ: GLUC:175 UREA:  CR:1,8 GOT:10 GPT: CT:214 TG:221 FAL:362 COL:214 ORINA:s/p, HBA1C: 7,9, proteinas urinarias 0,24 (VN 0,15/dia), clearence 63 (VN 80-140).                                                                                                                     		                                                      	6/6/2025	GR 4,79 HTO 40 HB 12,4 GB 6100 CR 1,80 GLUC 175 CT 214 TG 221 GOT 10 HBA1C 7,9 ORINA S/P Hipocromia clearence 63. Dolores articulares se entrega etoricoxib 120. OME: eco inguinal derecha, eco de abd y renal.          		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      	DBT                         	HTA                         	                              	                              	                        	                        	                        	                        	metformina 1gr x 69 c (dbi apforte)                         	AAS 100mg x 50c (x2meses)                         	losartan 100mg x 30c (losacor)                         	carvedilol 3,125mg (filten)                         	clonazepam 2mg x 60c (clonagin) duplicado                         	cilostazol 100mg x 30c (trastocit)                         	                              	                        	                        	                        	                        	                        	                        	                        	
140072107703	ALBARRACIN ALBA NOEMI	14578075																																																																																							
150262857107	ALBORNOZ BEATRIZ RAMONA	4954532																																																																																							
435001278302	ALCARAZ SILVIA ESTHER  	14824161		1150381197		3/12/1961	tamaleto2019@gmail.com			PAMI	3/24	HTO 40,8 GR 4,69 HB 14,2 GB 6860 B12 329 GLUC 244 PLAQ 299000 HBA1C 8,9 UREMIA 41 CR 0,81 CT 249 TG 129 GOT 17 GPT 9 TSH 2,25 VITD 33 ORINA NORMAL         		                  	5/24	ECO TIROIDEO: nodulo tiroideo, de bordes definidos- c/ oreas de calcio de 16,6x6,5 mm LD. LI 1/3 sup nodulo de 5,8 x 5mm, 1/3 medio nodulo 13,8x8,5. Plano post nodulo 11,4 x 9,2 mm. ISTNO: nodulo 17x9,3mm ECO TV: histerectomia         		                  	2/25	HTO 37 HB 13 GR 4,23 GB 6140 HBA1C 7,2 URICO 2,96 GLUC 156 PLAQ 256000 UREMIA 40 CR 0,69 VITD 32 CT 238 TG 98 GOT 17 GPT 7 ORINA S/P                  		                  		         		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  		                  	DBT     	HIPOTIROIDISMO     	          	          	        	        	        	        	METFORMINA 850 MG (DBI AP) X 60 C     	T4 50 MCG X 50 C (MONTPELLIER)     	          	          	          	          	          	          	        	        	        	        	        	        	        	
140114736300	ALEGRE MARIA DEL CARMEN	13855326																																																																																							
140097951800	ALLENDE MIRTHA AURORA	92173237																																																																																							
94935905	ALMADA MARICEL   	94935905		1169148867		22/11/1990			[Ljava.lang.Object;@2e202f23	NO	20/12/2024	Paciente con. dx de TAG, consulta por cefalea hemicraneana derecha,                            		         		         		         		         		         	     	                                	    	                               		         		                           																																					ACO          	NO REFIERE          	TAG                   	                   	        	                 	        	                 	          	                   	          	                   	          	                   	        	                 	        	        	        	        			
15573012670100	ALMEIRA NANCY GRISELDA      	28264608	65	1134034452		12/8/1975	nancyalmeira1234@gmail.com	164		PAMI	2/24	espirometria: normal, ALERGIA A DIPIRONA                                                      	6/24	gr 4,55 hb 14,5 hto 43,7 gb 9600 gluc 93 urea 20 cr 0,52 got 16 gpt 13 orina abundantes germenes                                                      		ecog. hepatobiliopancreatico: v. biliar multilitiasica. ECG: FC 75rpm, st isonivelado                                                      		                                                      		insulina 25,5                                                      		                                                      	1/1/2025	rm columna cervical: deshidratacion y protusion de c4 a c7, con compromiso neuroforaminal, se lateraliza hacia ambos lados de linea media. ome akm 10 sesiones cervicalgia, recetar pregabalina 75 mg practidosis, diclo + pridinol. ome toraco lumbo sacra.                                             		                                                      	21/3/2025	Rm encefalo: leve insinuacion de las amigdalas cerebelosas, sin descenso de las mismas. Quiste aracnoideo ubicado en la fosa craneal media derecha por delnate del polo temporal. Ome columna lumbo sacra: dorsal, deshidratacion de los discos, discoartrosis. Lumbosacro, deshidratacion de los discos D12 a S1 que contacta con el saco tecal y reduce el diámetro de ambos neuroforámenes. recetar diclo pridinol.                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                                                      		                           		                           		                           		                           		                           		                           		                           		                           	EPOC                              	                              	                              	                              	                        	                        	                        	                        	salbutamol                              	budesonide                              	clonagin 1mg x 30c                              	                              	                              	                              	                              	                        	                        	                        	                        	                        	                        	                        	
150469347201	ALMIRON OSCAR ALBERTO       	7739672	74	1151076989		7/12/1944	almironoscaralberto@gmail.com	173		PAMI	10/22	hto 41,3 gr 4,25 hb 13,4 gb 6960 gluc 109 uremia 40 cr 1,07 ct 240 tg 216 got 18 gpt 15 tsh 1,96 psa 1,58 CAMARA GAMA: s/ evidencia de isquemia miocardiaca, inducido por el ej.                                                               		                                                               	8/23	ECO CARDIO: normal MAPA: promedio 121-63 dia. 114-57 noche. registros sup en un 35% para la sistolica. conclu: normal TIENDE A LA BRADICAR, PROM 44 RPM RX TORAX: normal hto 42,2 gr 4,36 hb 13,6 gb 6270 b12 284 gluc 121 hba1c 6,0 uremia 41 cr 1,19 ct 194 tg 271 urico 7,12 got 18 gpt 12 tsh 2,31 t4 1,02 psa 3,09 orina normal                                                               		                                                               	10/24	hto 40,8 gr 4,31 hb 13,6 gb 7830 plaq 188000 folico 11,1 b12 323 gluc 118 uremia 49 cr 1,07 ct 190 tg 224 got 20 gpt 11 tsh 2,67 orina hb + psa 3,57                                                               		                                                      	28/3/2025	Holter 18/1: fc 56 lpm, bigeminismos. Ecodoppler cardiaco 01/25: v mitral y Ao ins. leve. Ecorenovesicopros 18/01: prostata heterogenea difusa. MAPA 28/1: HTA GI/II, aumento ta nocturno. ome laboratorio completo.                                                      		                                                               	30/5/2025	HTO 41 GR 4,35 HB 13,0 GB 7330 GOT 17 GPT 12 PLAQ 234000 GLUC 112 UREMIA 42 CR 1,14 PSA 3 CT 206 TG 108 URICEMIA 5,48 ORINA S/P Cardiologia le indico reducir el bisoprolol a 7,5 mg dia. Se susoende atorvastatina. Uro le indica tamsulosina 0,4 mg. ome cardio. Renovar receta dos enalapril, bisoprolol solamente.                                           		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               		                                                               	HTA                                   	                                   	                                   	                                   	                            	                            	                            	                            	          	bisoprolol 5mg x 60c (bisopril)                                   	          tamsulosina 0,4 mg               	  enalapril 10mg x 30c                                  	lotrial 5mg x 30 c                                   	                         	                                   	                            	                            	                            	                            	                            	                            	                            	
145925034606	ALONSO MONICA BEATRIZ	14825276																																																																																							
18226680	Alvarellos Andrea 	18226680		1122922938						OSDEPYME	9/5/2025	Labo 17/4: GR:4,93 HTO:43,5  HB:14 GB:8926 PLAQ: GLUC:130 UREA:39 CR:0,66  GOT:16 GPT:22  TG:158 VIT d:32,4 B12:374  TSH:2,055  ORINA: glucosuria + URICO:4,2. evc 04/25 : placa ateromatosa fibrocalcia en carotida derecha, y en izq sin repercucion hemodinamica. emg 3/25: afectacion de cpe, con compromiso axonal. Dolor que inicio hace 2 años en cara externa de MII, luego hallux MSD.  Se suspende pregabalina. Control en un mes.                                                                            		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         		         	DBT T II (dx hace 12 años)     	Sobrepeso     	HTA     	     	    	    	    	    	pregabalina 37.5 mg      	neuroactil ( l acetilcarnitina) 500 mg x 30 C     	clonazepam 1 mg x 30 C     	metformina 1000 mg /12 hs     	Acido tioctico 600 mg x 30 C     	Blastop (folico, b12, b6) x 30 C     	     	Dapaglifozina     	Losartan 50 x 60 C    	Atorvastatina 20 mg x 30 C    	    	    	    	    	
14009549250300	ALVAREZ ADRIANA EDITH        	14774602		1130802010		21/1/1962		1,61		PAMI	23/5/2023	Control gineco: Mamo birds -2, GCO ok                                                                        		Tiroides: Heterogenea difusa 16/3, modulo solido 3x6x6 quiste 5mm lobulo derecho, lobulo izquierdo 10x11x14 s/vascularizacion. Lobulo inferior 5x10x12 mm                                                                        		                                                               	16/11/2023	ct 221 got 18 gpt 11 ac. urico 4,1 cr 0,7 gluc 101 gr 4,48 hto 39 hb 13,8 gb 6600 plaq 265000 tg 101 vitD 33 orina normal tsh 2,20 uremia 27                                                                        		                                                                        	30/12/2024	GR: 4,67  HTO:42  HB:14 GB:6700 GLUC:84 UREA:25 CR:0,84 GOT:16 GPT:14 CT:182 TG:186 VIT d:24 B12:312 ORINA:s/p URICO:4, tsh 2,64 Gonalgia oyt le dijo que buena movilidad que inicie akm. Refiere estar cansada. Se indica vitamina D x 2 m, total magnesiao. ome cardio, endocrino, eco tiroidea, mamog, eco tv, gineco.                                                      		                                                                        	22/3/2025	Ecodoppler tiroideo: 16/3 LOBULO DERECHO Ecoestructura: heterogénea difusa con evidencia de imagen nodular solida, ligeramente heterogenea, de margenes regulares, en tercio medio,de 3 x 6 x 6 mm. Otro nodulo mixto, basal, a predominio quistico, de 5 mm, ambos con vascularizacion periferica. LOBULO IZQUIERDO Ecoestructura: heterogénea difusa con evidencia de imágenes nodulares de margenes regulares, basal posterior, nodulo quistico de 10 x 11 x 14 mm con tabiques y area ecogenica nodular intraquistica de 5 mm, que no mostraron vascularizacion ante el examen con doppler color. Vascularizacion periferica. En tercio medio posterior, nodulo solido,isoecogenico, de margenes regulares, de 7 x 8 x 9.5 mm, con vascularizacion periferica dominante y escasa central. En relacion inferior al lobulo, de localizacion extratiroidea, se observa una imagen solida, isoecogenica, de 5.5 x 10 x 12 mm, con vascularizacion periferica. Podria tener dependencia paratiroidea. Eco tiroides: 10/3 Lóbulo derecho: mide 35 x 17 x 14 mm. Se observan quistes coloideos, de 3.2 mm, 2.4 mm y 4.2 mm. -Lóbulo izquierdo: mide 43 x 25 x 20 mm. En tercio medio/inferior, imagen de características mixtas (sólida/líquida), de 22 x 14 mm, y en tercio superior, plano posterior, imagen espongiforme, de 9.5 x 8.7 mm.      mamo 16/1/25: birads 2 .                               		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                                                        		                                    		                                    		                                    		                                    		                                    		                                    		                                    		                                    	pericarditis (2022)                                        	HTA                                   	                                        	                                        	                                	                                	                                	                                	losartan 50 x 60 comp                                        	amlodipina 5 mg x 30 comp                                        	indapamida 1,5 mg                                        	ibupirac 400 mg x 30 comp (C.B.)                                        	esomeprazol 40 mg x 30 comp.                                        	lagrimas artificiales                                        	                                   	                            	                                	                                	                                	                                	
";

            var lines = data.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries).Skip(1);

            foreach (var line in lines)
            {
                var columns = line.Split('\t');
                if (columns.Length < 11 || string.IsNullOrWhiteSpace(columns[1])) continue;

                var dni = columns[2].Trim();
                if (string.IsNullOrWhiteSpace(dni)) continue;
                // Verificar si ya existe un paciente con ese DNI
                if (context.Pacientes.Any(p => p.DNI == dni))
                    continue;

                var nombreCompleto = columns[1].Trim().Replace("", "Ñ");
                var nombreParts = nombreCompleto.Split(new[] { ' ' }, 2, StringSplitOptions.RemoveEmptyEntries);
                var apellido = nombreParts.Length > 1 ? nombreParts[0] : nombreCompleto;
                var nombre = nombreParts.Length > 1 ? nombreParts[1] : "";

                if (!DateTime.TryParseExact(columns[6].Trim(), "d/M/yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out var fechaNacimiento))
                {
                    fechaNacimiento = new DateTime(1900, 1, 1);
                }

                var paciente = new Paciente
                {
                    NumeroAfiliado = columns[0].Trim(),
                    Nombre = nombre,
                    Apellido = apellido,
                    DNI = dni,
                    Telefono = columns[4].Trim(),
                    FechaNacimiento = fechaNacimiento,
                    Email = columns[7].Trim(),
                    ObraSocial = columns[10].Trim(),
                    Consultas = new List<Consulta>()
                };

                // Consultas
                for (int i = 11; i < 67 && i + 1 < columns.Length; i += 2)
                {
                    var fechaStr = columns[i].Trim();
                    var motivo = columns[i + 1].Trim();
                    if (DateTime.TryParseExact(fechaStr, "d/M/yyyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out var fechaConsulta) && !string.IsNullOrWhiteSpace(motivo))
                    {
                        paciente.Consultas.Add(new Consulta { Fecha = fechaConsulta, Motivo = motivo });
                    }
                }

                // Antecedentes
                var antecedentes = new List<string>();
                for (int i = 67; i < 75 && i < columns.Length; i++)
                {
                    var antecedente = columns[i].Trim();
                    if (!string.IsNullOrWhiteSpace(antecedente))
                    {
                        antecedentes.Add(antecedente);
                    }
                }
                paciente.Antecedentes = string.Join(", ", antecedentes);

                // Medicación
                var medicacion = new List<string>();
                for (int i = 75; i < columns.Length; i++)
                {
                    var med = columns[i].Trim();
                    if (!string.IsNullOrWhiteSpace(med))
                    {
                        medicacion.Add(med);
                    }
                }
                paciente.Medicacion = string.Join(", ", medicacion);
                
                context.Pacientes.Add(paciente);
            }
            context.SaveChanges();
        }
    }
} 